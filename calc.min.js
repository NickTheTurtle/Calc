function calc(n,t){if(n=n.replace(/ |\n|\t/g,""),!/^[a-zA-Z\d\.\+\-\*\/\%\^\(\)\,]*$/.test(n))throw new Error("Not allowed symbols: "+n.replace(/[a-zA-Z\d\.\+\-\*\/\%\^\(\)\,]*/g,"").split("").join(", "));if(!isNaN(Number(n)))return Number(n);var r={},e={},t=t||{};if(t.includeDefaults=t.includeDefaults||{constants:!0,functions:!0},void 0===t.includeDefaults.constants&&(t.includeDefaults.constants=!0),void 0===t.includeDefaults.functions&&(t.includeDefaults.functions=!0),t.includeDefaults.constants&&(r={e:Math.E,pi:Math.PI}),t.includeDefaults.functions&&(e={abs:function(n){return void 0===n?0:Math.abs(n)},sum:function(){for(var n=0,t=0;t<arguments.length;t++)n+=arguments[t];return n},count:function(){return arguments.length},average:function(){if(0===arguments.length)throw new Error("Average function requires at least one argument");for(var n=0,t=0;t<arguments.length;t++)n+=arguments[t];return n/arguments.length},max:function(){return Math.max.apply(Math,arguments)},min:function(){return Math.min.apply(Math,arguments)},round:function(n,t){if(void 0===n)throw new Error("Round function requires the num argument");return t=t||0,Math.round(n*Math.pow(10,t))/Math.pow(10,t)},floor:function(n,t){if(void 0===n&&void 0===t)throw new Error("Floor function requires the num argument");return t=t||0,Math.floor(n*Math.pow(10,t))/Math.pow(10,t)},ceil:function(n,t){if(void 0===n)throw new Error("Ceil function requires the num argument");return t=t||0,Math.ceil(n*Math.pow(10,t))/Math.pow(10,t)},ln:function(n){if(void 0===n)throw new Error("Ln function requires at the num argument");if(0>n)throw new Error("Ln function requires the num argument to be greater than or equal to 0");return Math.log(n)},log:function(n,t){if(void 0===n)throw new Error("Log function requires the num argument");if(0>n)throw new Error("Log function requires the num argument to be greater than or equal to 0");if(0>=t)throw new Error("Log function requires the base argument to be greater than 0");return t=t||10,Math.log(n)/Math.log(t)},log2:function(n){if(void 0===n)throw new Error("Log2 function requires the num argument");if(0>n)throw new Error("Log2 function requires the num argument to be greater than or equal to 0");return Math.log2?Math.log2(n):Math.log(n)/Math.LN2},log10:function(n){if(void 0===n)throw new Error("Log10 function requires the num argument");if(0>n)throw new Error("Log10 function requires the num argument to be greater than or equal to 0");return Math.log10?Math.log10(n):Math.log(n)/Math.LN10},sin:function(n){if(void 0===n)throw new Error("Sin function requires the num argument");return Math.sin(n)},sind:function(n){if(void 0===n)throw new Error("Sind function requires the num argument");return Math.sin(n*Math.PI/180)},asin:function(n){if(void 0===n)throw new Error("Asin function requires the num argument");if(Math.abs(n)>1)throw new Error("Asin function requires the num argument to be between -1 and 1 (inclusive)");return Math.asin(n)},asind:function(n){if(void 0===n)throw new Error("Sind function requires the num argument");if(Math.abs(n)>1)throw new Error("Asind function requires the num argument to be between -1 and 1 (inclusive)");return 180*Math.asin(n)/Math.PI},sinh:function(n){if(void 0===n)throw new Error("Sinh function requires the num argument");return Math.sinh?Math.sinh(n):(Math.exp(n)-Math.exp(-n))/2},asinh:function(n){if(void 0===n)throw new Error("Asinh function requires the num argument");return Math.asinh?Math.asinh(n):n===-(1/0)?n:Math.log(n+Math.sqrt(n*n+1))},cos:function(n){if(void 0===n)throw new Error("Cos function requires the num argument");return Math.cos(n)},cosd:function(n){if(void 0===n)throw new Error("Cosd function requires the num argument");return Math.cos(n*Math.PI/180)},acos:function(n){if(void 0===n)throw new Error("Acos function requires the num argument");if(Math.abs(n)>1)throw new Error("Acos function requires the num argument to be between -1 and 1 (inclusive)");return Math.acos(n)},acosd:function(n){if(void 0===n)throw new Error("Acosd function requires the num argument");if(Math.abs(n)>1)throw new Error("Acosd function requires the num argument to be between -1 and 1 (inclusive)");return 180*Math.acos(n)/Math.PI},cosh:function(n){if(void 0===n)throw new Error("Cosh function requires the num argument");return Math.cosh?Math.cosh(n):(Math.exp(n)+Math.exp(-n))/2},acosh:function(n){if(void 0===n)throw new Error("Acosh function requires the num argument");if(1>n)throw new Error("Acosh function requires the num argument to be greater than or equal to 1");return Math.acosh?Math.acosh(n):Math.log(n+Math.sqrt(n*n-1))},tan:function(n){if(void 0===n)throw new Error("Tan function requires the num argument");return Math.tan(n)},tand:function(n){if(void 0===n)throw new Error("Tand function requires the num argument");return Math.tan(n*Math.PI/180)},atan:function(n){if(void 0===n)throw new Error("Atan function requires the num argument");return Math.atan(n)},atan2:function(n,t){if(void 0===n)throw new Error("Atan2 function requires at least one argument");return t=t||1,Math.atan2(n,t)},atand:function(n){if(void 0===n)throw new Error("Atand function requires the num argument");return 180*Math.atan(n)/Math.PI},atand2:function(n,t){if(void 0===n)throw new Error("Atand2 function requires at least one argument");return t=t||1,180*Math.atan2(n,t)/Math.PI},tanh:function(n){if(void 0===n)throw new Error("Tanh function requires the num argument");return Math.tanh?Math.tanh(n):n===1/0?1:n===-(1/0)?-1:(Math.exp(n)-Math.exp(-n))/(Math.exp(n)+Math.exp(-n))},atanh:function(n){if(void 0===n)throw new Error("Atanh function requires the num argument");if(Math.abs(n)>1)throw new Error("Atanh function requires argument to be between -1 and 1 (inclusive)");return Math.atanh?Math.atanh(n):Math.log((1+n)/(1-n))/2},rand:function(n,t){return void 0===t&&(void 0===n?(n=0,t=1):(t=n,n=0)),Math.random()*(t-n)+n},randInt:function(n,t){return void 0===t&&(void 0===n?(n=0,t=1):(t=n,n=0)),Math.floor(Math.random()*(t-n+1)+n)}}),t.constants)for(var o in t.constants)if(Object.prototype.hasOwnProperty.call(t.constants,o)){if(!/^[a-zA-Z\.]+[\d\.]*$/.test(o))throw new Error('Custom constant name "'+o+'" not allowed');if(isNaN(Number(t.constants[o])))throw new Error('Custom constant "'+o+'" value not allowed');r[o]=t.constants[o]}if(t.functions)for(var o in t.functions)if(Object.prototype.hasOwnProperty.call(t.functions,o)){if(!/^[a-zA-Z\.]+[\d\.]*$/.test(o))throw new Error('Custom function name "'+o+'" not allowed');if("function"!=typeof t.functions[o])throw new Error('Custom function "'+o+'" is not a JavaScript function');e[o]=t.functions[o]}if(!isNaN(r[n]))return r[n];if("+"===n[0]&&!isNaN(r[n.slice(1)]))return r[n.slice(1)];if("-"===n[0]&&!isNaN(r[n.slice(1)]))return-r[n.slice(1)];for(var i=0,a=[],u=[],h=[],o=0;o<n.length;o++)if("("===n[o]?i++:")"===n[o]?i--:0===i&&("+"!==n[o]||!(2>o)&&/^[\d\.][eE]$/.test(n.slice(o-2,o))||0===o||/^[\+\-\*\/\%\^\(]$/.test(n[o-1])?"-"!==n[o]||!(2>o)&&/^[\d\.][eE]$/.test(n.slice(o-2,o))||0===o||/^[\+\-\*\/\%\^\(]$/.test(n[o-1])?0===a.length&&("*"===n[o]?u.push({index:o,sign:"*"}):"/"===n[o]?u.push({index:o,sign:"/"}):"%"===n[o]?u.push({index:o,sign:"%"}):"^"===n[o]&&0===u.length&&h.push(o)):a.push({index:o,sign:"-"}):a.push({index:o,sign:"+"})),0>i)throw new Error("Unbalanced parentheses");if(0!==i)throw new Error("Unbalanced parentheses");if(a.length>0){a.push({index:n.length});for(var s=calc(n.slice(0,a[0].index),t),o=0;o<a.length-1;o++)"+"===a[o].sign?s+=calc(n.slice(a[o].index+1,a[o+1].index),t):"-"===a[o].sign&&(s-=calc(n.slice(a[o].index+1,a[o+1].index),t));if(isNaN(s))throw new Error("Error");return s}if(u.length>0){u.push({index:n.length});for(var s=calc(n.slice(0,u[0].index),t),o=0;o<u.length-1;o++)"*"===u[o].sign?s*=calc(n.slice(u[o].index+1,u[o+1].index),t):"/"===u[o].sign?s/=calc(n.slice(u[o].index+1,u[o+1].index),t):"%"===u[o].sign&&(s%=calc(n.slice(u[o].index+1,u[o+1].index),t));if(isNaN(s))throw new Error("Error");return s}if(h.length>0){h.unshift(-1);for(var s=calc(n.slice(h[h.length-1]+1),t),o=h.length-2;o>-1;o--)s=Math.pow(calc(n.slice(h[o]+1,h[o+1]),t),s);if(isNaN(s))throw new Error("Error");return s}if(/^[\+\-]?\(.*\)$/.test(n))return"-"!==n[0]?calc(n.replace(/^\+?\((.*)\)$/,"$1"),t):-calc(n.replace(/^\-\((.*)\)$/,"$1"),t);if(/^[\+\-]?[a-zA-Z\.]+[\d\.]*\(.*\)$/.test(n)){var c=n.replace(/^[\+\-]?([a-zA-Z\.]+[\d\.]*)\(.*\)$/,"$1"),f=n.replace(/^[\+\-]?[a-zA-Z\.]+[\d\.]*\((.*)\)$/,"$1"),l=[],w=[];if(!e[c])throw new Error("Unrecognized function: "+c);if(f.length>0){for(var o=0;o<f.length;o++)"("===f[o]?i++:")"===f[o]?i--:","===f[o]&&0===i&&l.push(o);l.push(f.length),w.push(calc(f.slice(0,l[0]),t));for(var o=0;o<l.length;o++)w.push(calc(f.slice(l[o]+1,l[o+1]),t))}var s=e[c].apply(e,w);if(isNaN(s))throw new Error("Error");return"-"!==n[0]?s:-s}throw new Error("Error")}
